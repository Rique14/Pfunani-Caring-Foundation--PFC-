# ==============================================
# Pfunani Caring Foundation - Azure CI/CD Pipeline (FTP Deploy)
# ==============================================

trigger:
- main

pool:
  name: 'MyAgentPool'

steps:
# üß© Checkout code
- checkout: self
  displayName: 'Checkout Repository'

# üß± Install Node.js
- task: NodeTool@0
  inputs:
    versionSpec: '20.x'
  displayName: 'Install Node.js'

# ‚öôÔ∏è Build website
- script: |
    echo Installing dependencies...
    npm install || echo "No package.json found, skipping install."

    echo Building project...
    npm run build || echo "No build script found, skipping build."
  displayName: 'Build Website'

# üì¶ Archive website files
- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(System.DefaultWorkingDirectory)'
    includeRootFolder: false
    archiveType: 'zip'
    archiveFile: '$(Build.ArtifactStagingDirectory)/pfunani.zip'
    replaceExistingArchive: true
  displayName: 'Archive site files'

# üöÄ FTP Deploy directly (no service connection)
- task: FtpUpload@2
  displayName: 'üöÄ Deploy Website via FTP'
  inputs:
    credentialsOption: 'inputs'
    serverUrl: 'ftps://waws-prod-jnb21-011.ftp.azurewebsites.windows.net/site/wwwroot'   
    username: 'pfunani-webapp\$pfunani-webapp'                                                  
    password: 'H8w1DP4YvPbKGE7o4DoaQxp2gmcovSbalrsjaRzZH0RKumbtd8NrefrsGk7s'                                       
    rootDirectory: '$(System.DefaultWorkingDirectory)'
    filePatterns: '**'
    remoteDirectory: '/site/wwwroot'
    clean: true
    preservePaths: false
