# ==============================================
# Pfunani Caring Foundation - Azure CI/CD Pipeline (FTP Deploy)
# ==============================================

trigger:
- main   # Trigger build when main branch updates

pool:
  name: 'MyAgentPool'     #  your self-hosted agent

steps:
# üß© 1. Checkout code from GitHub
- checkout: self
  displayName: 'Checkout Repository'

# üß± 2. Install Node.js (for any JS build tasks)
- task: NodeTool@0
  inputs:
    versionSpec: '20.x'
  displayName: 'Install Node.js'

# ‚öôÔ∏è 3. Build the website
- script: |
    echo Installing dependencies...
    npm install || echo "No package.json found, skipping install."

    echo Building project...
    npm run build || echo "No build script found, skipping build."
  displayName: 'Build Website'

# üì¶ 4. Archive all files for deployment
- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(System.DefaultWorkingDirectory)'
    includeRootFolder: false
    archiveType: 'zip'
    archiveFile: '$(Build.ArtifactStagingDirectory)/pfunani.zip'
    replaceExistingArchive: true
  displayName: 'Archive site files'

# üöÄ 5. Publish the artifact (optional, keeps a copy)
- publish: '$(Build.ArtifactStagingDirectory)/pfunani.zip'
  artifact: drop
  displayName: 'Publish Artifact: pfunani.zip'

# üåç 6. Deploy via Publish Profile (FTP)
- task: AzureWebApp@1
  inputs:
    ConnectionType: 'PublishProfile'
    PublishProfilePath: '$(System.DefaultWorkingDirectory)/publish-profile/pfunani-webapp.publishsettings'
    appType: 'webApp'
    package: '$(Build.ArtifactStagingDirectory)/pfunani.zip'
  displayName: 'Deploy Website via Publish Profile'
